function initMap(){"use strict";map=new google.maps.Map(document.getElementById("map-area"),{center:{lat:32.7767,lng:-96.797},mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0});var e=new google.maps.InfoWindow,t=new google.maps.LatLngBounds,s=function(e){this.title=e.title,this.address=e.address,this.lat=e.lat,this.lng=e.lng,this.position=new google.maps.LatLng(this.lat,this.lng),this.marker=new google.maps.Marker({position:this.position,map:map,title:this.title,animation:google.maps.Animation.DROP})},o=function(){var o=this;o.shopList=ko.observableArray([]),o.filterList=ko.observableArray([]),o.query=ko.observable(""),o.showmobilepanel=ko.observable(!1),o.shopDetailMobile=ko.observable("");var i=window.matchMedia("(max-width: 700px)");i.matches?o.showSidelist=ko.observable(!1):o.showSidelist=ko.observable(!0),o.closeNav=function(){o.showSidelist(!1)},o.openNav=function(){o.showSidelist(!0),o.showmobilepanel(!1)};var n,a=function(){shopDatabase.forEach(function(e){o.shopList.push(new s(e))})},r=function(){o.shopList().forEach(function(e){t.extend(e.position),e.marker.addListener("click",function(){o.showStoreInfo(e)})})},l=function(e){null!==e.getAnimation()?e.setAnimation(null):(e.setAnimation(google.maps.Animation.BOUNCE),window.setTimeout(function(){e.setAnimation(null)},700))};o.showStoreInfo=function(e){l(e.marker),map.setCenter(e.position),map.setZoom(15),u(e),p(e,n)};var p=function(t,s){var i=window.matchMedia("(max-width: 700px)");i.matches?(o.shopDetailMobile(""),o.showmobilepanel(!0),o.closeNav(),o.shopDetailMobile(s)):(e.setContent(""),e.setContent(s),e.open(map,t.marker))};o.search=function(e){o.filterList([]),o.shopList().forEach(function(s){var i=s.title.toLowerCase();i.indexOf(e.toLowerCase())>=0?(o.filterList.push(s),s.marker.setVisible(!0),t.extend(s.position),map.fitBounds(t)):s.marker.setVisible(!1)})},o.onEnter=function(e,t){13===t.keyCode&&o.showStoreInfo(o.filterList()[0])};var u=function(e){var t="https://api.yelp.com/v2/search/",s=function(e){for(var t="",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=0;o<e;o++)t+=s.charAt(Math.floor(Math.random()*s.length));return t},o={oauth_consumer_key:"FBk0ZuP0PRBTekezNCM7xA",oauth_token:"Ix8AXGdC8aLnJQjnXTblYit7i64UnKzt",oauth_nonce:s(20),oauth_timestamp:Math.floor(Date.now()/1e3),oauth_signature_method:"HMAC-SHA1",oauth_version:"1.0",callback:"cb",term:e.title,location:"Dallas, tx",limit:1},i="X12-e9Q1AsLvNKGDpjKgMTZ4ep8",a="0sPuxJzhbHOK8YVc2iAdgih6v5A",r=oauthSignature.generate("GET",t,o,i,a);o.oauth_signature=r;var l={url:t,data:o,cache:!0,dataType:"jsonp"};$.ajax(l).done(function(t){var s=t.businesses[0].url?t.businesses[0].url:s="No link",o=t.businesses[0].rating?t.businesses[0].rating:o="No rating available",i=t.businesses[0].display_phone?t.businesses[0].display_phone:i="No phone number provided",a=t.businesses[0].address?t.businesses[0].address:a="Address not found",r=t.businesses[0].rating_img_url?t.businesses[0].rating_img_url:r=" ",l=t.businesses[0].review_count?t.businesses[0].review_count:a=" ",u='<h4 id="store-name">'+e.title+"</h4>",h="<p>Address: <span>"+a+"</span></p>",d='<a target="_blank" id="yelp-url" href="'+s+'">yelp:</a>',m='<span id="rating">'+o+"/5 </span>",c='<img id="rating-img" src ="'+r+'">',g='<span id="reviews">'+l+" reviews</span>",f="<p>Phone: "+i+"</p>";n=u+h+"<p>"+d+m+c+g+f+"</p>",p(e,n)}).fail(function(){alert("No Yelp Data")})};google.maps.event.addDomListener(window,"load",function(){a(),r(),o.filterList(o.shopList()),o.query.subscribe(o.search),map.fitBounds(t)}),google.maps.event.addDomListener(window,"resize",function(){map.fitBounds(t)})};ko.applyBindings(new o)}function googleError(){"use strict";alert("Oops! Cannot load the map")}var map;