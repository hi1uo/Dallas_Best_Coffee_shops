function initMap(){"use strict";map=new google.maps.Map(document.getElementById("map-area"),{center:{lat:32.7767,lng:-96.797},mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0});var e=new google.maps.InfoWindow,t=new google.maps.LatLngBounds,o=function(e){this.title=e.title,this.address=e.address,this.lat=e.lat,this.lng=e.lng,this.position=new google.maps.LatLng(this.lat,this.lng),this.marker=new google.maps.Marker({position:this.position,map:map,title:this.title,animation:google.maps.Animation.DROP})},i=function(){var i=this;i.shopList=ko.observableArray([]),i.filterList=ko.observableArray([]),i.query=ko.observable("");var a=window.matchMedia("(max-width: 700px)");a.matches?i.showSidelist=ko.observable(!1):i.showSidelist=ko.observable(!0),i.showmobilepanel=ko.observable(!1),i.detailmb=ko.observable(""),i.closeNav=function(){i.showSidelist(!1)},i.openNav=function(){i.showSidelist(!0)};var n=function(){shopDatabase.forEach(function(e){i.shopList.push(new o(e))})},s=function(){i.shopList().forEach(function(e){t.extend(e.position),e.marker.addListener("click",function(){i.showStoreInfo(e)})})},r=function(e){null!==e.getAnimation()?e.setAnimation(null):(e.setAnimation(google.maps.Animation.BOUNCE),window.setTimeout(function(){e.setAnimation(null)},700))};i.showStoreInfo=function(t){r(t.marker),map.setCenter(t.position),map.setZoom(15);var o='<div><h4 id="store-name">'+t.title+"</h4><p>Address: "+t.address+'</p><p><a target="_blank" id="yelp-url" data-bind="attr: {href: reviewsurl}">yelp </a>: <span id="rating"></span> <img id="yelp"> <span id="reviews"></span></p><p>Phone: <span id="phone"></span></p></div>',a=window.matchMedia("(max-width: 700px)");a.matches?(i.showmobilepanel(!0),i.detailmb(""),i.detailmb(o),i.closeNav()):(e.setContent(o),e.open(map,t.marker)),l(t)},i.search=function(e){i.filterList([]);for(var o in i.shopList()){var a=i.shopList()[o],n=a.title.toLowerCase();n.indexOf(e.toLowerCase())>=0?(i.filterList.push(i.shopList()[o]),a.marker.SetVisible(!0),t.extend(a.position),map.fitBounds(t)):a.marker.SetVisible(!1)}$("#search").keypress(function(e){13==e.which&&i.showStoreInfo(i.filterList()[0])})};var l=function(e){var t="https://api.yelp.com/v2/search/",o=function(e){for(var t="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<e;i++)t+=o.charAt(Math.floor(Math.random()*o.length));return t},a={oauth_consumer_key:"FBk0ZuP0PRBTekezNCM7xA",oauth_token:"Ix8AXGdC8aLnJQjnXTblYit7i64UnKzt",oauth_nonce:o(20),oauth_timestamp:Math.floor(Date.now()/1e3),oauth_signature_method:"HMAC-SHA1",oauth_version:"1.0",callback:"cb",term:e.title,location:"Dallas, tx",limit:1},n="X12-e9Q1AsLvNKGDpjKgMTZ4ep8",s="0sPuxJzhbHOK8YVc2iAdgih6v5A",r=oauthSignature.generate("GET",t,a,n,s);a.oauth_signature=r;var l={url:t,data:a,cache:!0,dataType:"jsonp",error:function(){}};$.ajax(l).done(function(e){i.reviewsurl("google.com"),console.log(i.reviewsurl),$("#yelp-url").attr("href",e.businesses[0].url),$("#rating").text(e.businesses[0].rating+"/5"),$("#reviews").text(e.businesses[0].review_count+" reviews"),$("#phone").text(e.businesses[0].display_phone)}).fail(function(e){$("#yelp").html("Error: No DATA.")})};google.maps.event.addDomListener(window,"load",function(){n(),s(),i.filterList(i.shopList()),i.query.subscribe(i.search),map.fitBounds(t)})};ko.applyBindings(new i)}function googleError(){alert("Oops! Cannot load the map")}var map;