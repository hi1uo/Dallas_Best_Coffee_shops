function initMap(){"use strict";map=new google.maps.Map(document.getElementById("map-area"),{center:{lat:32.7767,lng:-96.797},mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0});var e=new google.maps.InfoWindow,t=new google.maps.LatLngBounds,o=function(e){this.title=e.title,this.address=e.address,this.lat=e.lat,this.lng=e.lng,this.position=new google.maps.LatLng(this.lat,this.lng),this.marker=new google.maps.Marker({position:this.position,map:map,title:this.title,animation:google.maps.Animation.DROP})},i=function(){var i=this;i.shopList=ko.observableArray([]),i.filterList=ko.observableArray([]),i.query=ko.observable(""),i.showmobilepanel=ko.observable(!1),i.shopDetailMobil=ko.observable("");var a=window.matchMedia("(max-width: 700px)");a.matches?i.showSidelist=ko.observable(!1):i.showSidelist=ko.observable(!0),i.closeNav=function(){i.showSidelist(!1),i.showmobilepanel(!0)},i.openNav=function(){i.showSidelist(!0),i.showmobilepanel(!1)};var s,n=function(){shopDatabase.forEach(function(e){i.shopList.push(new o(e))})},r=function(){i.shopList().forEach(function(e){t.extend(e.position),e.marker.addListener("click",function(){i.showStoreInfo(e)})})},l=function(e){null!==e.getAnimation()?e.setAnimation(null):(e.setAnimation(google.maps.Animation.BOUNCE),window.setTimeout(function(){e.setAnimation(null)},700))};i.showStoreInfo=function(e){l(e.marker),map.setCenter(e.position),map.setZoom(15),h(e),p(e,s)};var p=function(t,o){var a=window.matchMedia("(max-width: 700px)");a.matches?(i.showmobilepanel(!0),i.closeNav(),i.shopDetailMobil(""),i.shopDetailMobil(o)):(e.setContent(o),e.open(map,t.marker))};i.search=function(e){i.filterList([]),i.shopList().forEach(function(o){var a=o.title.toLowerCase();a.indexOf(e.toLowerCase())>=0?(i.filterList.push(o),o.marker.setVisible(!0),t.extend(o.position),map.fitBounds(t)):o.marker.setVisible(!1)})},$("#search").keypress(function(e){13==e.which&&(console.log(i.filterList()[0]),i.showStoreInfo(i.filterList()[0]))});var h=function(e){var t="https://api.yelp.com/v2/search/",o=function(e){for(var t="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<e;i++)t+=o.charAt(Math.floor(Math.random()*o.length));return t},i={oauth_consumer_key:"FBk0ZuP0PRBTekezNCM7xA",oauth_token:"Ix8AXGdC8aLnJQjnXTblYit7i64UnKzt",oauth_nonce:o(20),oauth_timestamp:Math.floor(Date.now()/1e3),oauth_signature_method:"HMAC-SHA1",oauth_version:"1.0",callback:"cb",term:e.title,location:"Dallas, tx",limit:1},a="X12-e9Q1AsLvNKGDpjKgMTZ4ep8",n="0sPuxJzhbHOK8YVc2iAdgih6v5A",r=oauthSignature.generate("GET",t,i,a,n);i.oauth_signature=r;var l={url:t,data:i,cache:!0,dataType:"jsonp"};$.ajax(l).done(function(t){var o='<h4 id="store-name">'+e.title+"</h4>",i="<p>Address: <span>"+e.address+"</span></p>",a='<a target="_blank" id="yelp-url" href="'+t.businesses[0].url+'">yelp:</a>',n='<span id="rating">'+t.businesses[0].rating+"/5 </span>",r='<img id="rating-img" src ="'+t.businesses[0].rating_img_url+'">',l='<span id="reviews">'+t.businesses[0].review_count+" reviews</span>",h="<p>Phone: "+t.businesses[0].display_phone+"</p>";s=o+i+"<p>"+a+n+r+l+h+"</p>",p(e,s)}).fail(function(){alert("No Yelp Data")})};google.maps.event.addDomListener(window,"load",function(){n(),r(),i.filterList(i.shopList()),i.query.subscribe(i.search),map.fitBounds(t)})};ko.applyBindings(new i)}function googleError(){"use strict";alert("Oops! Cannot load the map")}var map;